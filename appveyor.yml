version: 0.2.0.{build}

branches:
  only:
    - master
    - dev
    - debug

skip_tags: true

#image: WMF 5
# Test ne build image:
image: Visual Studio 2017

# Install pester module and init the Appveyor support.
install:
  - ps: Import-Module .\tools\AppVeyor.psm1
  - ps: Invoke-InstallDependencies -Verbose

environment:
  NuGetToken:
    secure: 835qfZIkC9mE7QhkYfOZVAdR8rZhPvxG8BO4CbeaelRQOhlqmaSr8G1DWRJzZ/bS
  CoverallsToken:
    secure: eTjWqHL48MBr8wp1rSgLrXHdtpfDV/uClacP3svlWJfCvn/zVokpuaMnWM5RoyIY

build: false

before_build:
  - ps: Invoke-AppVeyorBumpVersion

build_script:
  - ps: Invoke-AppVeyorBuild

test_script:
  - ps: Invoke-AppVeyorTests
  - ps: Invoke-CoverageReport

deploy:
  #- provider: GitHub
  #  auth_token:
  #    secure: M+bBX5/nKdJB0eViP7xtrLVTwf3vGDUA9N2MMprZp2i+9ZR3CBVcJnSzJWUmalhB
  #  artifact: PSCredentialStore.zip           # upload all NuGet packages to release assets
  #  draft: true
  #  prerelease: true
  #  on:
  #    branch: dev
  - provider: GitHub
    auth_token:
      secure: M+bBX5/nKdJB0eViP7xtrLVTwf3vGDUA9N2MMprZp2i+9ZR3CBVcJnSzJWUmalhB
    artifact: PSCredentialStore.zip     # upload all NuGet packages to release assets
    draft: false
    prerelease: false
    on:
      branch: master                    # build release on master branch changes

after_deploy:
  - ps: Invoke-AppVeyorPSGallery -OnBranch 'master'
